"use strict";angular.module("bricksApp.storage",["firebase"]).service("localStorage",["$window",function(a){var b,c={},d={},e=function(c){var d=a.localStorage.getItem(b+c);return d?angular.fromJson(d):[]},f=function(d,e,f){var g=c[d]?angular.toJson(c[d]):"",h=!1;try{a.localStorage.setItem(b+d,g),h=!0}catch(i){f&&f()}finally{h&&e&&e()}},g=function(a,b){var c;return c=d[a]?d[a][b]:-1},h=function(a,b){b=b||0,d[a]=d[a]||[];for(var e=b;e<c[a].length;e++){var f=c[a][e].id;d[a][f]=e}},i=function(a,b){return c[a]||(c[a]=e(a),h(a)),b&&b(),c[a]},j=function(a){return b="bricks_app_"+a.id+"_",j};return j.all=function(a,b,c){return i(a,b,c)},j.get=function(a,b,d,e){i(a);var f=g(a,b);return f>-1?(d&&d(),c[a][f]):(e&&e(),void 0)},j.add=function(a,b,e,g){i(a);var h=(new Date).toISOString().split(".")[0].replace("T"," ");b.id=uuid(),b.created_at=h,b.updated_at=h,c[a]=c[a]||[],d[a]=d[a]||{};var j=c[a].length;d[a][b.id]=j,c[a][j]=b,f(a,e,g)},j.update=function(a,b,d,e){i(a);var h=g(a,b.id);return h>-1?(c[a][h]=b,f(a,d,e)):(e&&e(),void 0)},j.remove=function(a,b,d,e){i(a);var j=g(a,b.id);return j>-1?(c[a].splice(j,1),h(a,j),f(a,d,e)):(e&&e(),void 0)},j.clear=function(a,b,e){i(a),d[a]={},c[a].length=0,f(a,b,e)},j}]).factory("firebaseStorage",["Firebase","angularFireCollection",function(a,b){var c,d={},e=function(a){return c="https://"+a.settings.firebase+".firebaseio.com/",e},f=function(e,f,g){if(d[e])f&&f();else{var h=new a(c+e);h.once("value",function(){f&&f()},function(){g&&g()}),d[e]=b(h,null,function(a,b){"item_added"!==a||b.id||(b.id=b.$id,b.$ref.child("id").set(b.$id))})}return d[e]};return e.all=function(a,b,c){return f(a,b,c)},e.get=function(a,b,c,e){var g={};return f(a,function(){var f=d[a].getByName(b);f?(angular.copy(f,g),c&&c()):e&&e()}),g},e.add=function(a,b,c,e){var g=(new Date).toISOString().split(".")[0].replace("T"," ");b.created_at=g,b.updated_at=g,f(a,function(){d[a].add(b,function(a){a?e&&e():c&&c()})})},e.update=function(a,b,c,e){f(a,function(){d[a].update(b,function(a){a?e&&e():c&&c()})})},e.remove=function(a,b,c,e){f(a,function(){d[a].remove(b,function(a){a?e&&e():c&&c()})})},e.clear=function(b,d,e){new a(c+b).remove(function(a){a?e&&e():d&&d()})},e}]).factory("storage",["$injector",function(a){return function(b){var c;return c=b.storage?b.storage+"Storage":"localStorage",a.get(c)(b)}}]),angular.module("bricksApp",["ngRoute","bricksApp.storage"]).config(["$routeProvider",function(a){window.bricksApp.pages.forEach(function(b){a.when(b.url,{controller:"MainCtrl",template:b.template,resolve:{Storage:["$window","storage",function(a,b){return b(a.bricksApp)}]}})}),a.otherwise({template:"Nothing Found."})}]).run(["$window",function(a){angular.element("#bricksAppStyle").html(a.bricksApp.css)}]).controller("MainCtrl",["$location","$parse","$routeParams","$scope","$window","Storage",function($location,$parse,$routeParams,$scope,$window,Storage){var routeKeys=Object.keys($routeParams),data={};$window.bricksApp.tables.forEach(function(a){data[a.name]=Storage.all(a.name)}),$scope.data=data,routeKeys.length>0&&routeKeys.forEach(function(a){$scope[a]=Storage.get(a,$routeParams[a])||{}}),$scope.add=function(a,b){Storage.add(a,angular.copy(b),function(){$scope[a]={},$scope.$broadcast("database-row-added")})},$scope.update=function(a,b){Storage.update(a,b,function(){$scope.$broadcast("database-row-updated")})},$scope.remove=function(a,b){Storage.remove(a,b,function(){$scope.$broadcast("database-row-removed")})},$scope.visit=function(a,b){var c;c=b?a.replace(/:(\w+)/,b.id):a,$location.path(c)},eval($window.bricksApp.js)}]),angular.forEach({"database-row-added":"eventDatabaseRowAdded","database-row-updated":"eventDatabaseRowUpdated","database-row-removed":"eventDatabaseRowRemoved"},function(a,b){angular.module("bricksApp").directive(a,["$parse",function(c){return{compile:function(d,e){var f=c(e[a]);return function(a){a.$on(b,function(b){f(a,{$event:b})})}}}}])});