"use strict";angular.module("bricksApp.storage",["firebase"]).factory("localData",["$q","$window",function(a,b){var c,d={},e=function(a){var d=b.localStorage.getItem(c+a);return d?angular.fromJson(d):[]},f=function(a){var e=d[a]?angular.toJson(d[a]):"";b.localStorage.setItem(c+a,e)};return function(b,g){var h=a.defer();return d=g.data,c="bricks_app_"+b.id+"_",b.tables.forEach(function(a){g.data[a.name]=e(a.name),g.$watch("data."+a.name,function(){f(a.name)},!0)}),h.resolve(),h.promise}}]).factory("firebaseData",["$rootScope","angularFire",function(a,b){return function(a,c){return b(new Firebase("https://"+a.settings.firebase+".firebaseio.com"),c,"data")}}]).service("Storage",["$q","$rootScope","firebaseData","localData",function(a,b,c,d){var e,f={};return f.init=function(a){var g,h=b.$new();return h.data={},g="firebase"===a.storage?c(a,h):d(a,h),g.then(function(){return e=h.data,f})},f.all=function(a){return a?e[a]:e},f.get=function(a,b){var c;return e[a]&&e[a].some(function(a){return a.id===b?(c=a,!0):void 0}),c},f.add=function(a,b){var c=(new Date).toISOString().split(".")[0].replace("T"," ");b.id=uuid(),b.created_at=c,b.updated_at=c,e[a]=e[a]||[],e[a].push(b)},f.update=function(a,b){e[a]&&e[a].some(function(c,d){return c.id===b.id?(e[a][d]=b,!0):void 0})},f.remove=function(a,b){e[a]&&e[a].some(function(c,d){return c.id===b.id?(e[a].splice(d,1),!0):void 0})},f.clear=function(a){e[a].length=0},f}]),angular.module("bricksApp",["ngRoute","bricksApp.storage"]).config(["$routeProvider",function(a){window.bricksApp.pages.forEach(function(b){a.when(b.url,{controller:"MainCtrl",template:b.template,resolve:{storage:["$window","Storage",function(a,b){return b.init(a.bricksApp)}]}})}),a.otherwise({template:"Nothing Found."})}]).run(["$window",function(a){angular.element("#bricksAppStyle").html(a.bricksApp.css)}]).controller("MainCtrl",["$location","$parse","$routeParams","$scope","$window","storage",function($location,$parse,$routeParams,$scope,$window,storage){var routeKeys=Object.keys($routeParams);$scope.data=storage.all(),routeKeys.length>0&&routeKeys.forEach(function(a){$scope[a]=storage.get(a,$routeParams[a])||{}}),$scope.add=function(a,b,c){c&&c.preventDefault(),storage.add(a,angular.copy(b)),$scope[a]={}},$scope.update=function(a,b,c){c&&c.preventDefault(),storage.update(a,b)},$scope.remove=function(a,b,c){c&&c.preventDefault(),storage.remove(a,b)},$scope.visit=function(a,b){b&&b.preventDefault(),$location.path(a)},eval($window.bricksApp.js)}]);