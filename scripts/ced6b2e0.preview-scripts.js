"use strict";angular.module("bricksApp.storage",["firebase"]).factory("localData",["$q","$window",function(a,b){var c,d={},e=function(a){var d=b.localStorage.getItem(c+a);return d?angular.fromJson(d):[]},f=function(a){var e=d[a]?angular.toJson(d[a]):"";b.localStorage.setItem(c+a,e)};return function(b,g){var h=a.defer();return d=g.data,c="bricks_app_"+b.id+"_",b.tables.forEach(function(a){g.data[a.name]=e(a.name),g.$watch("data."+a.name,function(){f(a.name)},!0)}),h.resolve(),h.promise}}]).factory("firebaseData",["$rootScope","angularFire",function(a,b){return function(a,c){return b(new Firebase("https://"+a.settings.firebase+".firebaseio.com"),c,"data")}}]).service("storage",["$q","$rootScope","firebaseData","localData",function(a,b,c,d){var e=b.$new();return e.init=function(a){var b;return e.data={},b="firebase"===a.storage?c(a,e):d(a,e),b.then(function(){return e})},e.all=function(a){return a?e.data[a]:e.data},e.get=function(a,b){var c;return e.data[a]&&e.data[a].some(function(a){return a.id===b?(c=a,!0):void 0}),c},e.add=function(a,b){var c=(new Date).toISOString().split(".")[0].replace("T"," ");b.id=uuid(),b.created_at=c,b.updated_at=c,e.data[a]=e.data[a]||[],e.data[a].push(b)},e.update=function(a,b){e.data[a]&&e.data[a].some(function(c,d){return c.id===b.id?(e.data[a][d]=b,!0):void 0})},e.remove=function(a,b){e.data[a]&&e.data[a].some(function(c,d){return c.id===b.id?(e.data[a].splice(d,1),!0):void 0})},e.clear=function(a){e.data[a].length=0},e}]),angular.module("bricksApp",["ngRoute","bricksApp.storage"]).config(["$routeProvider",function(a){window.bricksApp.pages.forEach(function(b){a.when(b.url,{controller:"MainCtrl",template:b.template,resolve:{Storage:["$window","storage",function(a,b){return b.init(a.bricksApp)}]}})}),a.otherwise({template:"Nothing Found."})}]).run(["$window",function(a){angular.element("#bricksAppStyle").html(a.bricksApp.css)}]).controller("MainCtrl",["$location","$parse","$routeParams","$scope","$window","Storage",function($location,$parse,$routeParams,$scope,$window,Storage){var routeKeys=Object.keys($routeParams);$scope.$watch(function(){return Storage.all()},function(a){$scope.data=a}),routeKeys.length>0&&routeKeys.forEach(function(a){$scope[a]=Storage.get(a,$routeParams[a])||{}}),$scope.add=function(a,b){Storage.add(a,angular.copy(b)),$scope[a]={}},$scope.update=function(a,b){Storage.update(a,b)},$scope.remove=function(a,b){Storage.remove(a,b)},$scope.visit=function(a){$location.path(a)},eval($window.bricksApp.js)}]);